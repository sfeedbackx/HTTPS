<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>// Place global declarations here.
//===================================================
/// TCP
//===================================================
//chanel
chan syn;
chan synack;
chan fin;
chan noack;
chan rest;
chan ackn;
//tcp var/const
const int RETRY_MAX_COUNT = 2;
int will_be_rec_succ_from_client;
int retry_count ;
int will_be_rec_succ_from_server;
int seq_need_to_be_ack;
//===================================================
/// TLS
//===================================================
//channel
chan startTls;
chan clientHello;
chan serverHello;
chan passed;
chan clientKeyExchange;
chan finTls;
chan terminate;
chan session_fin;
chan reject;
// client_suite
int client_suite;
// 32 random generated by the client extra layer of security
const int client_random_byte = 66;
// 32 random generated by the server extra layer of security
const int server_random_byte = 88;
// public diffy hellman
const int g = 3;
const int n = 50;
int ag;
int bg;
bool valid_certificate = true;
const int hash_fin = 2;
int[0, 2147483647] power(int base, int e) {
    int[0, 2147483647] result = 1;
    int i;
    for(i = 0; i &lt; e; i++) {
        result = result * base;
    }
    return result;
}
int encrypt_fin;
//===================================================
/// HTTP
//===================================================
//channel
chan tcpSyn;
chan tcpTlsEstablished;
chan req;
chan body;
chan red;
chan noBody;
chan auth;
chan error;
chan newReq;
chan resBody;
chan resFin;
// tcp var
const bool tcpConnectionValid[2] = {false, true};
bool chosenTcpConnection ;
int fllowHttpStan;
int vbody;
//request
int reqType;

// response
int res;





</declaration>
	<template>
		<name x="5" y="5">https_client</name>
		<declaration>// Place local declarations here.
//===================================================
/// TCP
//===================================================
int seq =0;
int ack = 0;
//===================================================
/// TLS
//===================================================
const int a = 5;
int client_master_key;
int decrypted_fin;
//===================================================
/// HTTP
//===================================================

//reqs 
const int reqList[8] = {2000,2001,2040,2041,3010,3011,4010,4011};

</declaration>
		<location id="id0" x="-357" y="-42">
			<name x="-442" y="-51">CLOSED</name>
		</location>
		<location id="id1" x="85" y="-68">
			<name x="-17" y="-25">SYN_ACK_SERVER_RECIVED</name>
		</location>
		<location id="id2" x="-170" y="102">
			<name x="-280" y="110">SYN_RESENT</name>
		</location>
		<location id="id3" x="323" y="-42">
			<name x="365" y="-110">ACK_SYN_SERVER_SUCC</name>
		</location>
		<location id="id4" x="136" y="-127">
			<name x="153" y="-127">ACK_SYN_SERVER_RECIVED_NOTSUCC</name>
		</location>
		<location id="id5" x="-170" y="-42">
			<name x="-161" y="-34">SYN_SENT</name>
		</location>
		<location id="id6" x="637" y="-34">
			<name x="552" y="-76">TLS_FLOW</name>
		</location>
		<location id="id7" x="688" y="34">
			<name x="663" y="68">CLIENT_HELLO_WORLD</name>
		</location>
		<location id="id8" x="1147" y="-34">
			<name x="1071" y="-76">SERVER_HELLO_RECIVED</name>
		</location>
		<location id="id9" x="1309" y="-34">
			<name x="1299" y="-68">CLIENT_KEY_EXCHANGE_SENT</name>
		</location>
		<location id="id10" x="1470" y="-144">
			<name x="1487" y="-187">FIN_TLS_INTEGRITY</name>
		</location>
		<location id="id11" x="1606" y="-25">
			<name x="1547" y="-68">TLS_DONE_FULL_ENCRYT_MSG</name>
		</location>
		<location id="id12" x="3034" y="-25">
			<name x="3024" y="-59">RESPONSE_RECIVED</name>
		</location>
		<location id="id13" x="2822" y="127">
			<name x="2812" y="93">REDIRECTION</name>
		</location>
		<location id="id14" x="2830" y="-153">
			<name x="2820" y="-187">DATA_VALID</name>
		</location>
		<location id="id15" x="2822" y="-25">
			<name x="2812" y="-59">NO_DATA</name>
		</location>
		<location id="id16" x="1972" y="-25">
			<name x="1962" y="-59">NEED_REQUEST</name>
		</location>
		<location id="id17" x="2125" y="-25">
			<name x="2115" y="-59">REQUEST_SENT</name>
		</location>
		<location id="id18" x="2465" y="-153">
			<name x="2490" y="-238">BODY_REQUESTED</name>
		</location>
		<location id="id19" x="1802" y="-25">
			<name x="1751" y="-76">TCP_AND_TLS_CONNECTION</name>
		</location>
		<location id="id20" x="1802" y="-195">
			<name x="1792" y="-229">ERROR_FAILURE</name>
		</location>
		<location id="id21" x="2125" y="93">
			<name x="2115" y="59">Auth_ACCESS_OBTAINED</name>
		</location>
		<init ref="id0"/>
		<transition id="id22">
			<source ref="id17"/>
			<target ref="id13"/>
			<label kind="guard" x="2184" y="119">chosenTcpConnection &amp;&amp; fllowHttpStan &amp;&amp; (reqType == 3010 || reqType == 3011)</label>
			<label kind="synchronisation" x="2609" y="102">red!</label>
			<nail x="2414" y="-25"/>
			<nail x="2422" y="127"/>
		</transition>
		<transition id="id23">
			<source ref="id17"/>
			<target ref="id18"/>
			<label kind="guard" x="2201" y="-127">chosenTcpConnection &amp;&amp; fllowHttpStan &amp;&amp;  (reqType == 2000 || reqType == 2001)</label>
			<label kind="synchronisation" x="2397" y="-110">body!</label>
			<nail x="2414" y="-25"/>
			<nail x="2414" y="-153"/>
		</transition>
		<transition id="id24">
			<source ref="id17"/>
			<target ref="id15"/>
			<label kind="guard" x="2227" y="-68">chosenTcpConnection &amp;&amp; fllowHttpStan &amp;&amp;  (reqType == 2040 || reqType == 2041)</label>
			<label kind="synchronisation" x="2533" y="-51">noBody!</label>
		</transition>
		<transition id="id25">
			<source ref="id12"/>
			<target ref="id0"/>
			<nail x="3213" y="-25"/>
			<nail x="3204" y="-510"/>
			<nail x="3153" y="-552"/>
			<nail x="3153" y="-552"/>
			<nail x="-365" y="-518"/>
			<nail x="-510" y="-272"/>
			<nail x="-382" y="-42"/>
		</transition>
		<transition id="id26">
			<source ref="id12"/>
			<target ref="id19"/>
			<label kind="guard" x="1786" y="144">res != 3 &amp;&amp; (res == 200 || res == 301 || res == 204)</label>
			<label kind="synchronisation" x="1786" y="161">newReq?</label>
			<nail x="3060" y="-8"/>
			<nail x="3060" y="187"/>
			<nail x="1768" y="170"/>
			<nail x="1751" y="144"/>
		</transition>
		<transition id="id27">
			<source ref="id12"/>
			<target ref="id20"/>
			<label kind="guard" x="1854" y="-382">res == 3</label>
			<label kind="synchronisation" x="1854" y="-365">error?</label>
			<nail x="3060" y="-51"/>
			<nail x="3043" y="-357"/>
			<nail x="1836" y="-340"/>
		</transition>
		<transition id="id28">
			<source ref="id21"/>
			<target ref="id19"/>
			<nail x="1793" y="93"/>
		</transition>
		<transition id="id29">
			<source ref="id21"/>
			<target ref="id20"/>
			<label kind="guard" x="2143" y="59">res == 3</label>
			<label kind="synchronisation" x="2143" y="76">error?</label>
			<nail x="2235" y="93"/>
			<nail x="2227" y="-195"/>
		</transition>
		<transition id="id30">
			<source ref="id18"/>
			<target ref="id20"/>
			<label kind="guard" x="1871" y="-314">!vbody</label>
			<label kind="synchronisation" x="1980" y="-280">error?</label>
			<nail x="2465" y="-280"/>
			<nail x="1853" y="-280"/>
		</transition>
		<transition id="id31">
			<source ref="id13"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="2840" y="110">resFin?</label>
			<nail x="3034" y="127"/>
		</transition>
		<transition id="id32">
			<source ref="id15"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="2840" y="-42">resFin?</label>
		</transition>
		<transition id="id33">
			<source ref="id14"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="2848" y="-174">resFin?</label>
			<nail x="3043" y="-161"/>
		</transition>
		<transition id="id34">
			<source ref="id18"/>
			<target ref="id14"/>
			<label kind="guard" x="2483" y="-187">vbody</label>
			<label kind="synchronisation" x="2483" y="-170">resBody?</label>
		</transition>
		<transition id="id35">
			<source ref="id17"/>
			<target ref="id21"/>
			<label kind="guard" x="2125" y="0">chosenTcpConnection &amp;&amp; fllowHttpStan &amp;&amp;(reqType == 4010 || reqType == 4011)</label>
			<label kind="synchronisation" x="2125" y="17">auth!</label>
		</transition>
		<transition id="id36">
			<source ref="id20"/>
			<target ref="id19"/>
			<label kind="synchronisation" x="1742" y="-153">newReq!</label>
		</transition>
		<transition id="id37">
			<source ref="id16"/>
			<target ref="id20"/>
			<label kind="guard" x="1820" y="-144">!chosenTcpConnection</label>
			<label kind="synchronisation" x="1820" y="-127">error!</label>
		</transition>
		<transition id="id38">
			<source ref="id16"/>
			<target ref="id17"/>
			<label kind="select" x="1990" y="-76">reqi : int[0,7]</label>
			<label kind="guard" x="1989" y="-93">chosenTcpConnection</label>
			<label kind="synchronisation" x="1938" y="17">req!</label>
			<label kind="assignment" x="1938" y="0">reqType = reqList[reqi]</label>
		</transition>
		<transition id="id39">
			<source ref="id19"/>
			<target ref="id16"/>
			<label kind="synchronisation" x="1810" y="-51">tcpTlsEstablished?</label>
			<label kind="assignment" x="1820" y="-25">reqType =0</label>
		</transition>
		<transition id="id40">
			<source ref="id11"/>
			<target ref="id19"/>
		</transition>
		<transition id="id41">
			<source ref="id3"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="341" y="-55">startTls!</label>
		</transition>
		<transition id="id42">
			<source ref="id11"/>
			<target ref="id6"/>
			<nail x="1606" y="-272"/>
			<nail x="1589" y="-297"/>
			<nail x="714" y="-297"/>
			<nail x="688" y="-280"/>
		</transition>
		<transition id="id43">
			<source ref="id11"/>
			<target ref="id6"/>
			<nail x="1462" y="204"/>
			<nail x="654" y="204"/>
		</transition>
		<transition id="id44">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="guard" x="1530" y="8">decrypted_fin == hash_fin</label>
			<label kind="synchronisation" x="1488" y="-101">passed!</label>
		</transition>
		<transition id="id45">
			<source ref="id10"/>
			<target ref="id6"/>
			<label kind="guard" x="732" y="-221">!decrypted_fin == hash_fin</label>
			<label kind="synchronisation" x="1003" y="-221">reject!</label>
			<nail x="1470" y="-153"/>
			<nail x="1436" y="-187"/>
			<nail x="714" y="-187"/>
		</transition>
		<transition id="id46">
			<source ref="id9"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="1344" y="-114">finTls?</label>
			<label kind="assignment" x="1113" y="-153">decrypted_fin = encrypt_fin/client_master_key</label>
			<nail x="1326" y="-51"/>
		</transition>
		<transition id="id47">
			<source ref="id8"/>
			<target ref="id9"/>
			<label kind="guard" x="1156" y="-25">valid_certificate</label>
			<label kind="synchronisation" x="1164" y="34">clientKeyExchange!</label>
			<label kind="assignment" x="1156" y="17">ag=power(g,a)%n,client_master_key=power(bg,a)%n</label>
		</transition>
		<transition id="id48">
			<source ref="id8"/>
			<target ref="id6"/>
			<label kind="guard" x="697" y="-93">!valid_certificate</label>
			<label kind="synchronisation" x="697" y="-68">reject!</label>
		</transition>
		<transition id="id49">
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="synchronisation" x="841" y="17">serverHello?</label>
			<nail x="714" y="42"/>
			<nail x="1113" y="42"/>
		</transition>
		<transition id="id50">
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="667" y="-30">reject?</label>
			<nail x="697" y="8"/>
		</transition>
		<transition id="id51">
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="527" y="-8">clientHello!</label>
			<label kind="assignment" x="510" y="17">client_suite=5</label>
			<nail x="629" y="0"/>
		</transition>
		<transition id="id52">
			<source ref="id1"/>
			<target ref="id3"/>
			<label kind="guard" x="170" y="-76">will_be_rec_succ_from_server</label>
			<label kind="synchronisation" x="136" y="-59">ackn!</label>
			<label kind="assignment" x="59" y="-42">ack = seq_need_to_be_ack+1</label>
			<nail x="102" y="-42"/>
		</transition>
		<transition id="id53">
			<source ref="id1"/>
			<target ref="id4"/>
			<label kind="guard" x="136" y="-110">!will_be_rec_succ_from_server</label>
			<label kind="synchronisation" x="136" y="-93">noack!</label>
			<nail x="119" y="-68"/>
		</transition>
		<transition id="id54">
			<source ref="id4"/>
			<target ref="id0"/>
			<label kind="guard" x="-330" y="-157">retry_count&gt; RETRY_MAX_COUNT</label>
			<label kind="synchronisation" x="-330" y="-140">rest!</label>
			<label kind="assignment" x="-330" y="-123">ack =0, seq=0</label>
			<nail x="-348" y="-119"/>
			<nail x="-348" y="-68"/>
		</transition>
		<transition id="id55">
			<source ref="id4"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="68" y="-110">syn?</label>
		</transition>
		<transition id="id56">
			<source ref="id4"/>
			<target ref="id0"/>
			<label kind="guard" x="-339" y="-208">retry_count&gt; RETRY_MAX_COUNT</label>
			<label kind="synchronisation" x="-339" y="-191">rest?</label>
			<label kind="assignment" x="-339" y="-174">ack =0, seq=0</label>
			<nail x="136" y="-178"/>
			<nail x="-357" y="-170"/>
		</transition>
		<transition id="id57">
			<source ref="id2"/>
			<target ref="id0"/>
			<label kind="guard" x="-484" y="-8">retry_count&gt; RETRY_MAX_COUNT</label>
			<label kind="synchronisation" x="-272" y="17">rest?</label>
			<label kind="assignment" x="-272" y="34">ack =0, seq=0</label>
			<nail x="-187" y="76"/>
			<nail x="-195" y="59"/>
			<nail x="-314" y="-17"/>
			<nail x="-340" y="-25"/>
		</transition>
		<transition id="id58">
			<source ref="id2"/>
			<target ref="id0"/>
			<label kind="guard" x="-501" y="68">retry_count&gt; RETRY_MAX_COUNT</label>
			<label kind="synchronisation" x="-323" y="42">rest!</label>
			<label kind="assignment" x="-314" y="85">ack =0, seq=0</label>
			<nail x="-212" y="93"/>
			<nail x="-246" y="76"/>
			<nail x="-331" y="17"/>
		</transition>
		<transition id="id59">
			<source ref="id5"/>
			<target ref="id2"/>
			<label kind="guard" x="-161" y="51">!will_be_rec_succ_from_client</label>
			<label kind="synchronisation" x="-187" y="-17">noack?</label>
			<nail x="-170" y="-25"/>
		</transition>
		<transition id="id60">
			<source ref="id5"/>
			<target ref="id1"/>
			<label kind="guard" x="-144" y="-68">will_be_rec_succ_from_client</label>
			<label kind="synchronisation" x="-51" y="-93">synack?</label>
			<nail x="-144" y="-68"/>
			<nail x="51" y="-68"/>
		</transition>
		<transition id="id61">
			<source ref="id0"/>
			<target ref="id5"/>
			<label kind="select" x="-289" y="-110">i : int[0,1]</label>
			<label kind="synchronisation" x="-289" y="-34">syn!</label>
			<label kind="assignment" x="-858" y="-85">will_be_rec_succ_from_client=i,seq =1000 , ack=0,seq_need_to_be_ack=seq</label>
			<nail x="-340" y="-42"/>
		</transition>
		<transition id="id62">
			<source ref="id3"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="-279" y="212">fin!</label>
			<label kind="assignment" x="-279" y="229">ack =0, seq=0</label>
			<nail x="323" y="212"/>
			<nail x="289" y="229"/>
			<nail x="-297" y="229"/>
			<nail x="-365" y="170"/>
		</transition>
		<transition id="id63">
			<source ref="id3"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="-288" y="-323">fin?</label>
			<label kind="assignment" x="-288" y="-306">ack =0, seq=0</label>
			<nail x="323" y="-289"/>
			<nail x="297" y="-306"/>
			<nail x="-306" y="-306"/>
			<nail x="-340" y="-280"/>
			<nail x="-374" y="-238"/>
			<nail x="-374" y="-59"/>
		</transition>
		<transition id="id64">
			<source ref="id2"/>
			<target ref="id5"/>
			<label kind="select" x="-76" y="-8">i : int [ 0,1]</label>
			<label kind="guard" x="-102" y="25">retry_count &lt;= RETRY_MAX_COUNT &amp;&amp; !will_be_rec_succ_from_client</label>
			<label kind="synchronisation" x="-136" y="93">syn!</label>
			<label kind="assignment" x="-93" y="8">will_be_rec_succ_from_client = i,retry_count++</label>
			<nail x="-153" y="102"/>
			<nail x="-51" y="-42"/>
			<nail x="-144" y="-42"/>
		</transition>
	</template>
	<template>
		<name>https_server</name>
		<declaration>//===================================================
/// TCP
//===================================================
int seq =0;
int ack = 0;

//===================================================
/// TLS
//===================================================
const int SERVER_SUITES[4] = {1, 2, 5, 7};
const int SERVER_SUITE_COUNT = 4;

// Helper function to check if cipher suite is supported
bool is_suite_supported(int suite) {
    int i;
    for(i = 0; i &lt; SERVER_SUITE_COUNT; i++) {
        if(SERVER_SUITES[i] == suite) {
            return true;
        }
    }
    return false;
}

const int b = 2;

int server_master_key ;

//===================================================
/// HTTP
//===================================================
//function to handle valid 
int reqValidOrNot(int req){
int valid = req%10;
int res = req/10;
if (valid){
return res;
}else{
return 3;
}

}</declaration>
		<location id="id65" x="-365" y="-59">
			<name x="-375" y="-93">LISTEN</name>
		</location>
		<location id="id66" x="-170" y="-59">
			<name x="-246" y="-136">SYN_CLIENT_RECEVED</name>
		</location>
		<location id="id67" x="255" y="-85">
			<name x="255" y="-76">CLIENT_ACK_REC_SUCC_SYN_ACK_SENT</name>
		</location>
		<location id="id68" x="348" y="-178">
			<name x="357" y="-212">CLIENT_ACK_REC_SUCC_SYN_ACK_RESENT</name>
		</location>
		<location id="id69" x="0" y="170">
			<name x="-10" y="136">CLIENT_ACK_REC_SUCC_SYN_ACK_SUCC</name>
		</location>
		<location id="id70" x="-246" y="17">
			<name x="-229" y="-17">ACK_REFUSED</name>
		</location>
		<location id="id71" x="3221" y="178">
			<name x="3211" y="144">RESPONSE_SENT</name>
		</location>
		<location id="id72" x="1989" y="178">
			<name x="1955" y="110">TCP_AND_TLS_CONNECTION</name>
		</location>
		<location id="id73" x="1989" y="8">
			<name x="1979" y="-26">ERROR_FAILURE</name>
		</location>
		<location id="id74" x="2312" y="296">
			<name x="2176" y="306">Auth_ACCESS_GIVEN</name>
		</location>
		<location id="id75" x="2652" y="50">
			<name x="2642" y="16">BODY_RECIVED</name>
		</location>
		<location id="id76" x="3009" y="330">
			<name x="2999" y="296">REDIRECTION</name>
		</location>
		<location id="id77" x="3009" y="178">
			<name x="2999" y="144">NO_DATA</name>
		</location>
		<location id="id78" x="3017" y="50">
			<name x="3007" y="16">DATA_VALID</name>
		</location>
		<location id="id79" x="2312" y="178">
			<name x="2320" y="195">REQUEST_RECIVED</name>
		</location>
		<location id="id80" x="2159" y="178">
			<name x="2040" y="187">LISNING_REQUEST</name>
		</location>
		<location id="id81" x="1793" y="178">
			<name x="1783" y="144">TLS_DONE_FULL_ENCRYT_MSG</name>
		</location>
		<location id="id82" x="824" y="169">
			<name x="739" y="127">TLS_FLOW</name>
		</location>
		<location id="id83" x="1657" y="59">
			<name x="1674" y="16">FIN_TLS_INTEGRITY</name>
		</location>
		<location id="id84" x="1496" y="169">
			<name x="1486" y="135">CLIENT_KEY_CHANGE_RECIVED</name>
		</location>
		<location id="id85" x="1334" y="169">
			<name x="1258" y="127">SERVER_HELLO_SENT</name>
		</location>
		<location id="id86" x="875" y="237">
			<name x="865" y="203">CLIENT_HELLO_RECIVED</name>
		</location>
		<init ref="id65"/>
		<transition id="id87">
			<source ref="id79"/>
			<target ref="id76"/>
			<label kind="guard" x="2592" y="340">chosenTcpConnection &amp;&amp; fllowHttpStan &amp;&amp; (reqType == 3010 || reqType == 3011)</label>
			<label kind="synchronisation" x="2609" y="314">red?</label>
			<label kind="assignment" x="2643" y="272">res = reqValidOrNot(reqType)</label>
			<nail x="2592" y="178"/>
			<nail x="2592" y="331"/>
		</transition>
		<transition id="id88">
			<source ref="id79"/>
			<target ref="id75"/>
			<label kind="select" x="2439" y="153">bv : int[0,1]</label>
			<label kind="guard" x="2431" y="76">chosenTcpConnection &amp; fllowHttpStan &amp;&amp;  (reqType == 2000 || reqType == 2001)</label>
			<label kind="synchronisation" x="2592" y="25">body?</label>
			<label kind="assignment" x="2414" y="178">vbody = bv</label>
			<nail x="2592" y="178"/>
			<nail x="2592" y="51"/>
		</transition>
		<transition id="id89">
			<source ref="id79"/>
			<target ref="id77"/>
			<label kind="guard" x="2592" y="127">chosenTcpConnection &amp;&amp; fllowHttpStan &amp;&amp;  (reqType == 2040 || reqType == 2041)</label>
			<label kind="synchronisation" x="2669" y="187">noBody?</label>
			<label kind="assignment" x="2643" y="153">res = reqValidOrNot(reqType)</label>
		</transition>
		<transition id="id90">
			<source ref="id69"/>
			<target ref="id82"/>
			<label kind="synchronisation" x="18" y="152">startTls?</label>
		</transition>
		<transition id="id91">
			<source ref="id70"/>
			<target ref="id65"/>
			<label kind="guard" x="-314" y="-34">retry_count&gt; RETRY_MAX_COUNT</label>
			<label kind="synchronisation" x="-297" y="-17">rest!</label>
			<nail x="-263" y="-25"/>
		</transition>
		<transition id="id92">
			<source ref="id70"/>
			<target ref="id65"/>
			<label kind="guard" x="-374" y="34">retry_count&gt; RETRY_MAX_COUNT</label>
			<label kind="synchronisation" x="-348" y="8">rest?</label>
			<nail x="-289" y="17"/>
		</transition>
		<transition id="id93">
			<source ref="id66"/>
			<target ref="id70"/>
			<label kind="guard" x="-221" y="8">!will_be_rec_succ_from_client</label>
			<label kind="synchronisation" x="-136" y="-8">noack!</label>
			<nail x="-153" y="-34"/>
			<nail x="-195" y="8"/>
		</transition>
		<transition id="id94">
			<source ref="id70"/>
			<target ref="id66"/>
			<label kind="synchronisation" x="-221" y="-51">syn?</label>
			<nail x="-221" y="-25"/>
		</transition>
		<transition id="id95">
			<source ref="id69"/>
			<target ref="id65"/>
			<label kind="synchronisation" x="-373" y="76">fin?</label>
			<label kind="assignment" x="-373" y="93">ack =0, seq=0</label>
			<nail x="-59" y="93"/>
			<nail x="-391" y="93"/>
			<nail x="-399" y="-34"/>
		</transition>
		<transition id="id96">
			<source ref="id69"/>
			<target ref="id65"/>
			<label kind="synchronisation" x="-398" y="153">fin!</label>
			<label kind="assignment" x="-398" y="170">ack =0, seq=0</label>
			<nail x="-416" y="170"/>
			<nail x="-416" y="-42"/>
			<nail x="-382" y="-59"/>
		</transition>
		<transition id="id97">
			<source ref="id67"/>
			<target ref="id69"/>
			<label kind="guard" x="59" y="51">will_be_rec_succ_from_server</label>
			<label kind="synchronisation" x="42" y="17">ackn?</label>
		</transition>
		<transition id="id98">
			<source ref="id68"/>
			<target ref="id65"/>
			<label kind="guard" x="-407" y="-327">retry_count&gt; RETRY_MAX_COUNT</label>
			<label kind="synchronisation" x="-407" y="-310">rest?</label>
			<label kind="assignment" x="-407" y="-293">ack =0, seq=0</label>
			<nail x="348" y="-297"/>
			<nail x="-425" y="-289"/>
			<nail x="-425" y="-93"/>
		</transition>
		<transition id="id99">
			<source ref="id68"/>
			<target ref="id65"/>
			<label kind="guard" x="-136" y="-280">retry_count&gt; RETRY_MAX_COUNT</label>
			<label kind="synchronisation" x="-25" y="-238">rest!</label>
			<label kind="assignment" x="264" y="-221">ack =0, seq=0</label>
			<nail x="340" y="-187"/>
			<nail x="246" y="-255"/>
			<nail x="-374" y="-255"/>
			<nail x="-374" y="-93"/>
		</transition>
		<transition id="id100">
			<source ref="id68"/>
			<target ref="id67"/>
			<label kind="select" x="365" y="-161">j : int[0,1]</label>
			<label kind="guard" x="348" y="-144">retry_count&lt;= RETRY_MAX_COUNT</label>
			<label kind="synchronisation" x="306" y="-110">syn!</label>
			<label kind="assignment" x="340" y="-127">will_be_rec_succ_from_server = j,retry_count++</label>
			<nail x="348" y="-144"/>
		</transition>
		<transition id="id101">
			<source ref="id67"/>
			<target ref="id68"/>
			<label kind="guard" x="59" y="-178">!will_be_rec_succ_from_server</label>
			<label kind="synchronisation" x="238" y="-161">noack?</label>
			<nail x="263" y="-119"/>
			<nail x="314" y="-178"/>
		</transition>
		<transition id="id102">
			<source ref="id66"/>
			<target ref="id67"/>
			<label kind="select" x="93" y="-119">j : int[0,1]</label>
			<label kind="guard" x="-136" y="-110">will_be_rec_succ_from_client</label>
			<label kind="synchronisation" x="187" y="-110">synack!</label>
			<label kind="assignment" x="-136" y="-59">will_be_rec_succ_from_server = j, retry_count = 0 , ack = seq_need_to_be_ack+1,seq=3000 ,seq_need_to_be_ack=seq</label>
			<nail x="-153" y="-85"/>
		</transition>
		<transition id="id103">
			<source ref="id65"/>
			<target ref="id66"/>
			<label kind="synchronisation" x="-289" y="-85">syn?</label>
			<label kind="assignment" x="-347" y="-59">ack =0 ,seq=0</label>
		</transition>
		<transition id="id104">
			<source ref="id71"/>
			<target ref="id72"/>
			<label kind="guard" x="1973" y="347">res != 3 &amp;&amp; (res == 200 || res == 301 || res == 204)</label>
			<label kind="synchronisation" x="1973" y="364">newReq!</label>
			<nail x="3247" y="195"/>
			<nail x="3247" y="390"/>
			<nail x="1955" y="373"/>
			<nail x="1938" y="347"/>
		</transition>
		<transition id="id105">
			<source ref="id71"/>
			<target ref="id73"/>
			<label kind="guard" x="2041" y="-179">res == 3</label>
			<label kind="synchronisation" x="2041" y="-162">error!</label>
			<nail x="3247" y="152"/>
			<nail x="3230" y="-154"/>
			<nail x="2023" y="-137"/>
		</transition>
		<transition id="id106">
			<source ref="id74"/>
			<target ref="id72"/>
			<label kind="guard" x="2014" y="255">res != 3 &amp;&amp; res == 401</label>
			<label kind="synchronisation" x="1998" y="279">newReq!</label>
			<nail x="1980" y="296"/>
		</transition>
		<transition id="id107">
			<source ref="id74"/>
			<target ref="id73"/>
			<label kind="guard" x="2218" y="-17">res == 3</label>
			<label kind="synchronisation" x="2303" y="-17">error!</label>
			<nail x="2422" y="296"/>
			<nail x="2414" y="8"/>
		</transition>
		<transition id="id108">
			<source ref="id75"/>
			<target ref="id73"/>
			<label kind="guard" x="2193" y="-102">!vbody</label>
			<label kind="synchronisation" x="2091" y="-102">error!</label>
			<nail x="2652" y="-77"/>
			<nail x="2040" y="-77"/>
		</transition>
		<transition id="id109">
			<source ref="id76"/>
			<target ref="id71"/>
			<label kind="synchronisation" x="3027" y="313">resFin!</label>
			<nail x="3221" y="330"/>
		</transition>
		<transition id="id110">
			<source ref="id77"/>
			<target ref="id71"/>
			<label kind="synchronisation" x="3027" y="161">resFin!</label>
		</transition>
		<transition id="id111">
			<source ref="id78"/>
			<target ref="id71"/>
			<label kind="synchronisation" x="3035" y="29">resFin!</label>
			<nail x="3230" y="42"/>
		</transition>
		<transition id="id112">
			<source ref="id75"/>
			<target ref="id78"/>
			<label kind="guard" x="2670" y="16">vbody</label>
			<label kind="synchronisation" x="2670" y="33">resBody!</label>
			<label kind="assignment" x="2670" y="50">res = reqValidOrNot(reqType)</label>
		</transition>
		<transition id="id113">
			<source ref="id79"/>
			<target ref="id74"/>
			<label kind="guard" x="2167" y="229">chosenTcpConnection &amp; fllowHttpStan &amp;&amp;(reqType == 4010 || reqType == 4011)</label>
			<label kind="synchronisation" x="2295" y="204">auth?</label>
			<label kind="assignment" x="2218" y="246">res = reqValidOrNot(reqType)</label>
		</transition>
		<transition id="id114">
			<source ref="id73"/>
			<target ref="id72"/>
			<label kind="synchronisation" x="1989" y="76">newReq?</label>
		</transition>
		<transition id="id115">
			<source ref="id80"/>
			<target ref="id73"/>
			<label kind="synchronisation" x="2007" y="76">error?</label>
		</transition>
		<transition id="id116">
			<source ref="id80"/>
			<target ref="id79"/>
			<label kind="select" x="2184" y="136">vh : int [0,1]</label>
			<label kind="guard" x="2167" y="153">chosenTcpConnection</label>
			<label kind="synchronisation" x="2210" y="178">req?</label>
			<label kind="assignment" x="2082" y="204">fllowHttpStan = vh ,res = 0</label>
		</transition>
		<transition id="id117">
			<source ref="id72"/>
			<target ref="id80"/>
			<label kind="synchronisation" x="1997" y="153">tcpTlsEstablished!</label>
		</transition>
		<transition id="id118">
			<source ref="id81"/>
			<target ref="id72"/>
		</transition>
		<transition id="id119">
			<source ref="id81"/>
			<target ref="id82"/>
			<nail x="1793" y="-69"/>
			<nail x="1776" y="-94"/>
			<nail x="901" y="-94"/>
			<nail x="875" y="-77"/>
		</transition>
		<transition id="id120">
			<source ref="id81"/>
			<target ref="id82"/>
			<nail x="1649" y="407"/>
			<nail x="841" y="407"/>
		</transition>
		<transition id="id121">
			<source ref="id83"/>
			<target ref="id81"/>
			<label kind="synchronisation" x="1675" y="101">passed?</label>
			<label kind="assignment" x="1675" y="118">chosenTcpConnection = 1</label>
		</transition>
		<transition id="id122">
			<source ref="id83"/>
			<target ref="id82"/>
			<label kind="synchronisation" x="919" y="-1">reject?</label>
			<nail x="1657" y="50"/>
			<nail x="1623" y="16"/>
			<nail x="901" y="16"/>
		</transition>
		<transition id="id123">
			<source ref="id84"/>
			<target ref="id83"/>
			<label kind="synchronisation" x="1531" y="88">finTls!</label>
			<label kind="assignment" x="1326" y="51">encrypt_fin=hash_fin*server_master_key</label>
			<nail x="1513" y="152"/>
		</transition>
		<transition id="id124">
			<source ref="id85"/>
			<target ref="id84"/>
			<label kind="guard" x="1360" y="204">valid_certificate</label>
			<label kind="synchronisation" x="1343" y="221">clientKeyExchange?</label>
			<label kind="assignment" x="1351" y="187">server_master_key=power(ag,b)%50</label>
		</transition>
		<transition id="id125">
			<source ref="id85"/>
			<target ref="id82"/>
			<label kind="guard" x="842" y="135">!valid_certificate</label>
			<label kind="synchronisation" x="842" y="152">reject!</label>
		</transition>
		<transition id="id126">
			<source ref="id86"/>
			<target ref="id85"/>
			<label kind="guard" x="1071" y="255">is_suite_supported(client_suite)</label>
			<label kind="synchronisation" x="919" y="228">serverHello!</label>
			<label kind="assignment" x="919" y="245">bg=power(g,b)%n</label>
			<nail x="901" y="245"/>
			<nail x="1300" y="245"/>
		</transition>
		<transition id="id127">
			<source ref="id86"/>
			<target ref="id82"/>
			<label kind="guard" x="867" y="187">!is_suite_supported(client_suite)</label>
			<label kind="synchronisation" x="854" y="173">reject!</label>
			<nail x="884" y="211"/>
		</transition>
		<transition id="id128">
			<source ref="id82"/>
			<target ref="id86"/>
			<label kind="synchronisation" x="663" y="212">clientHello?</label>
			<nail x="816" y="203"/>
		</transition>
	</template>
	<system>// Place template instantiations here.
HttpsClient = https_client();
HttpsServer = https_server();
// List one or more processes to be composed into a system.
system HttpsClient , HttpsServer;
</system>
	<queries>
		<query>
			<formula>A[] not deadlock</formula>
			<comment/>
			<result outcome="success" type="quality" timestamp="2025-12-02 15:33:34 +0100">
			</result>
		</query>
		<query>
			<formula>TcpServer.CLIENT_ACK_REC_SUCC_SYN_ACK_SUCC --&gt; TcpClient.ACK_SYN_SERVER_SUCC</formula>
			<comment/>
			<result outcome="success" type="quality" timestamp="2025-12-08 11:58:07 +0100">
			</result>
		</query>
		<query>
			<formula>TcpClient.CLOSED --&gt; TcpServer.LISTEN</formula>
			<comment/>
			<result outcome="success" type="quality" timestamp="2025-12-02 15:34:43 +0100">
			</result>
		</query>
		<query>
			<formula>TcpServer.CLIENT_ACK_REC_SUCC_SYN_ACK_SUCC --&gt; TcpClient.ack == TcpServer.seq+1 &amp;&amp; TcpServer.ack == TcpClient.seq+1</formula>
			<comment/>
			<result outcome="success" type="quality" timestamp="2025-12-02 15:31:21 +0100">
			</result>
		</query>
	</queries>
</nta>
